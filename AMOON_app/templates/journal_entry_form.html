{% load static %}
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠØ¯ Ø¬Ø¯ÙŠØ¯</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    body {
      direction: rtl;
      background-color: #f8f9fa;
      font-family: 'Cairo', sans-serif;
    }
    .container {
      margin-top: 50px;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
    }
    th, td {
      text-align: center;
      vertical-align: middle;
    }
    .form-control {
      text-align: right;
    }
    .add-line, .del-line {
      cursor: pointer;
      color: blue;
    }
    .del-line:hover {
      color: red;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠØ¯ Ø¬Ø¯ÙŠØ¯</h1>
    <!-- Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù† ÙˆØ¬Ø¯Øª -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-info">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <form method="post">
      {% csrf_token %}
      <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
      <div class="card mb-3">
        <div class="card-header">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ÙŠØ¯</div>
        <div class="card-body">
          {{ form.non_field_errors }}
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="id_reference">Ø§Ù„Ù…Ø±Ø¬Ø¹</label>
              {{ form.reference }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="id_accounting_date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              {{ form.accounting_date }}
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="id_journal">Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</label>
              {{ form.journal }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="id_state">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              {{ form.state }}
            </div>
          </div>
          <div class="mb-3">
            <label for="id_comment">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</label>
            {{ form.comment }}
          </div>
        </div>
      </div>

      <!-- Ø£Ø³Ø·Ø± Ø§Ù„Ù‚ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Formset -->
      <div class="card mb-3">
        <div class="card-header">Ø§Ù„Ø£Ø³Ø·Ø± (Journal Items)</div>
        <div class="card-body">
          {{ formset.management_form }}
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th>Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                <th>Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
                <th>Ø§Ù„ÙˆØµÙ (Label)</th>
                <th>Ù…Ø¯ÙŠÙ†</th>
                <th>Ø¯Ø§Ø¦Ù†</th>
                <th>Tax Grids</th>
                <th>Ø­Ø°Ù</th>
              </tr>
            </thead>
            <tbody>
              {% for form in formset.forms %}
                <tr>
                  <td>{{ form.account }}</td>
                  <td>{{ form.partner }}</td>
                  <td>{{ form.label }}</td>
                  <td>{{ form.debit }}</td>
                  <td>{{ form.credit }}</td>
                  <td>{{ form.tax_grids }}</td>
                  <td>
                    <!-- Ø­Ù‚Ù„ Ø§Ù„Ø­Ø°Ù Ù…Ù† formset -->
                    {% if formset.can_delete %}
                      {{ form.DELETE }}
                      <span class="del-line" onclick="toggleDelete('{{ forloop.counter0 }}')">ğŸ—‘</span>
                      {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <!-- Ø²Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ (Ø¹Ø¨Ø± Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· extra) -->
          <button type="button" class="btn btn-primary" id="add-line">Ø£Ø¶Ù Ø³Ø·Ø±Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§</button>
        </div>
      </div>

      <button type="submit" class="btn btn-success">Ø­ÙØ¸</button>
      <a href="#" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡</a>
    </form>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
    // Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ø· Ù„Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¹Ø¨Ø± Ù†Ø³Ø® Ø¢Ø®Ø± Ø³Ø·Ø± (ÙŠØ­ØªØ§Ø¬ ØªØ®ØµÙŠØµ)
    // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ù„ÙˆÙ„ Ø£ÙƒØ«Ø± Ù…Ø±ÙˆÙ†Ø© Ù…Ø«Ù„ django formset dynamic
    let formIndex = '{{ formset.total_form_count|default:"0" }}';
    $('#add-line').click(function() {
      // Ù†Ù†Ø³Ø® Ø¢Ø®Ø± Ø³Ø·Ø±
      let newForm = $('tbody tr:last').clone(true);
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ‡Ø§Ø±Ø³ ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
      newForm.html(newForm.html().replace(/form\-\d+/g, 'form-' + formIndex));
      $('tbody').append(newForm);
      formIndex++;
      // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙÙŠ management_form
      $('#id_form-TOTAL_FORMS').val(formIndex);
    });

    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø°Ù
    function toggleDelete(index) {
      let checkbox = document.getElementById(`id_form-${index}-DELETE`);
      checkbox.checked = !checkbox.checked;
    }
  </script>
</body>
</html>
